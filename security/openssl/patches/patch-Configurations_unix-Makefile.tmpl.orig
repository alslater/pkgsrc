$NetBSD: patch-Configurations_unix-Makefile.tmpl,v 1.3 2020/09/29 05:45:04 martin Exp $

Use pkgsrc layout.
Do not install HTML documentation.
Avoid -B $NUM argument to m4 (ignored by most m4 implementations, not
supported by others)

--- Configurations/unix-Makefile.tmpl.orig	2023-03-30 11:14:09.483621773 +0000
+++ Configurations/unix-Makefile.tmpl
@@ -311,9 +311,10 @@ MODULESDIR=$(libdir)/ossl-modules
 # libraries and applications
 LIBRPATH=$(libdir)
 
-MANDIR=$(INSTALLTOP)/share/man
+MANDIR=$(INSTALLTOP)/share/$(PKGMANDIR)
 DOCDIR=$(INSTALLTOP)/share/doc/$(BASENAME)
 HTMLDIR=$(DOCDIR)/html
+EXAMPLEDIR=$(INSTALLTOP)/share/examples/openssl
 
 # MANSUFFIX is for the benefit of anyone who may want to have a suffix
 # appended after the manpage file section number.  "ssl" is popular,
@@ -611,7 +612,7 @@ install_sw: install_dev install_engines
 
 uninstall_sw: uninstall_runtime uninstall_modules uninstall_engines uninstall_dev
 
-install_docs: install_man_docs install_html_docs
+install_docs: install_man_docs
 
 uninstall_docs: uninstall_man_docs uninstall_html_docs
 	$(RM) -r $(DESTDIR)$(DOCDIR)
@@ -646,48 +647,48 @@ uninstall_fips:
 
 
 install_ssldirs:
-	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(OPENSSLDIR)/certs
-	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(OPENSSLDIR)/private
-	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(OPENSSLDIR)/misc
+	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(EXAMPLEDIR)/certs
+	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(EXAMPLEDIR)/private
+	@$(PERL) $(SRCDIR)/util/mkdir-p.pl $(DESTDIR)$(EXAMPLEDIR)/misc
 	@set -e; for x in dummy $(MISC_SCRIPTS); do \
 		if [ "$$x" = "dummy" ]; then continue; fi; \
 		x1=`echo "$$x" | cut -f1 -d:`; \
 		x2=`echo "$$x" | cut -f2 -d:`; \
 		fn=`basename $$x1`; \
-		$(ECHO) "install $$x1 -> $(DESTDIR)$(OPENSSLDIR)/misc/$$fn"; \
-		cp $$x1 $(DESTDIR)$(OPENSSLDIR)/misc/$$fn.new; \
-		chmod 755 $(DESTDIR)$(OPENSSLDIR)/misc/$$fn.new; \
-		mv -f $(DESTDIR)$(OPENSSLDIR)/misc/$$fn.new \
-		      $(DESTDIR)$(OPENSSLDIR)/misc/$$fn; \
+		$(ECHO) "install $$x1 -> $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn"; \
+		cp $$x1 $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn.new; \
+		chmod 755 $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn.new; \
+		mv -f $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn.new \
+		      $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn; \
 		if [ "$$x1" != "$$x2" ]; then \
 			ln=`basename "$$x2"`; \
 			: {- output_off() unless windowsdll(); "" -}; \
-			$(ECHO) "copy $(DESTDIR)$(OPENSSLDIR)/misc/$$ln -> $(DESTDIR)$(OPENSSLDIR)/misc/$$fn"; \
-			cp $(DESTDIR)$(OPENSSLDIR)/misc/$$fn $(DESTDIR)$(OPENSSLDIR)/misc/$$ln; \
+			$(ECHO) "copy $(DESTDIR)$(EXAMPLEDIR)/misc/$$ln -> $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn"; \
+			cp $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn $(DESTDIR)$(EXAMPLEDIR)/misc/$$ln; \
 			: {- output_on() unless windowsdll();
 			     output_off() if windowsdll(); "" -}; \
-			$(ECHO) "link $(DESTDIR)$(OPENSSLDIR)/misc/$$ln -> $(DESTDIR)$(OPENSSLDIR)/misc/$$fn"; \
-			ln -sf $$fn $(DESTDIR)$(OPENSSLDIR)/misc/$$ln; \
+			$(ECHO) "link $(DESTDIR)$(EXAMPLEDIR)/misc/$$ln -> $(DESTDIR)$(EXAMPLEDIR)/misc/$$fn"; \
+			ln -sf $$fn $(DESTDIR)$(EXAMPLEDIR)/misc/$$ln; \
 			: {- output_on() if windowsdll(); "" -}; \
 		fi; \
 	done
-	@$(ECHO) "install $(SRCDIR)/apps/openssl.cnf -> $(DESTDIR)$(OPENSSLDIR)/openssl.cnf.dist"
-	@cp $(SRCDIR)/apps/openssl.cnf $(DESTDIR)$(OPENSSLDIR)/openssl.cnf.new
-	@chmod 644 $(DESTDIR)$(OPENSSLDIR)/openssl.cnf.new
-	@mv -f  $(DESTDIR)$(OPENSSLDIR)/openssl.cnf.new $(DESTDIR)$(OPENSSLDIR)/openssl.cnf.dist
-	@if [ ! -f "$(DESTDIR)$(OPENSSLDIR)/openssl.cnf" ]; then \
-		$(ECHO) "install $(SRCDIR)/apps/openssl.cnf -> $(DESTDIR)$(OPENSSLDIR)/openssl.cnf"; \
-		cp $(SRCDIR)/apps/openssl.cnf $(DESTDIR)$(OPENSSLDIR)/openssl.cnf; \
-		chmod 644 $(DESTDIR)$(OPENSSLDIR)/openssl.cnf; \
+	@$(ECHO) "install $(SRCDIR)/apps/openssl.cnf -> $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf.dist"
+	@cp $(SRCDIR)/apps/openssl.cnf $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf.new
+	@chmod 644 $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf.new
+	@mv -f  $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf.new $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf.dist
+	@if [ ! -f "$(DESTDIR)$(EXAMPLEDIR)/openssl.cnf" ]; then \
+		$(ECHO) "install $(SRCDIR)/apps/openssl.cnf -> $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf"; \
+		cp $(SRCDIR)/apps/openssl.cnf $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf; \
+		chmod 644 $(DESTDIR)$(EXAMPLEDIR)/openssl.cnf; \
 	fi
-	@$(ECHO) "install $(SRCDIR)/apps/ct_log_list.cnf -> $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf.dist"
-	@cp $(SRCDIR)/apps/ct_log_list.cnf $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf.new
-	@chmod 644 $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf.new
-	@mv -f  $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf.new $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf.dist
-	@if [ ! -f "$(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf" ]; then \
-		$(ECHO) "install $(SRCDIR)/apps/ct_log_list.cnf -> $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf"; \
-		cp $(SRCDIR)/apps/ct_log_list.cnf $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf; \
-		chmod 644 $(DESTDIR)$(OPENSSLDIR)/ct_log_list.cnf; \
+	@$(ECHO) "install $(SRCDIR)/apps/ct_log_list.cnf -> $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf.dist"
+	@cp $(SRCDIR)/apps/ct_log_list.cnf $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf.new
+	@chmod 644 $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf.new
+	@mv -f  $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf.new $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf.dist
+	@if [ ! -f "$(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf" ]; then \
+		$(ECHO) "install $(SRCDIR)/apps/ct_log_list.cnf -> $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf"; \
+		cp $(SRCDIR)/apps/ct_log_list.cnf $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf; \
+		chmod 644 $(DESTDIR)$(EXAMPLEDIR)/ct_log_list.cnf; \
 	fi
 
 install_dev: install_runtime_libs
@@ -1569,7 +1570,7 @@ EOF
               $generator = 'CC="$(CC)" $(PERL)'.$gen_incs.' '.$gen0.$gen_args
                   .' "$(PERLASM_SCHEME)"'.$incs.' '.$cppflags.$defs.' $(PROCESSOR)';
           } elsif ($gen0 =~ /\.m4$/) {
-              $generator = 'm4 -B 8192'.$gen_incs.' '.$gen0.$gen_args.' >'
+              $generator = 'm4 '.$gen_incs.' '.$gen0.$gen_args.' >'
           } elsif ($gen0 =~ /\.S$/) {
               $generator = undef;
           } else {
